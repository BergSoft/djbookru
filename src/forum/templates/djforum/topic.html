{% extends "djforum/base.html" %}

{% load i18n staticfiles pagination_tags bootstrap forum_tags %}
{% load url from future %}

{% block head %}
    {{ block.super }}
    {{ form.media }}
    <script>
    jQuery(function($){
        $('.post-form').submit(function(){
            if ( ! $('textarea', this).val()){
                alert('{% trans "Enter message" %}');
                return false;
            }
        });

        $('.answer-post').click(function(){
            var $post = $(this).parents('.post').find('.post-content').clone();
            $post.find('blockquote').remove();

            var text = $.trim($post.text());
            text = '>'+text.replace(/(\r\n|\n|\r)/gm, "\n\n>")

            $('#id_body').focus().val($('#id_body').val()+text+'\n\n');
            return false;
        });

        $('.delete-post').click(function(){
            return confirm('{% trans "Do you wish delete this post?" %}');
        });

        $('.delete-topic').click(function(){
           return confirm('{% trans "Do you wish delete this topic?" %}');
        })
    });
    </script>
{% endblock %}

{% block content %}
    <aside class="widget forum">

        <ul class="breadcrumb">
            <li><a class="title" href="{{ forum.category.get_absolute_url }}">{{ forum.category }}</a> <span class="divider">/</span></li>
            <li><a class="title forum" href="{{ forum.get_absolute_url }}">{{ forum }}</a> <span class="divider">/</span></li>
            <li class="active">{{ topic }}</li>
        </ul>

        <a href="{% url 'forum:add_post' topic.pk %}" class="pull-right btn btn-small" style="margin-bottom: 5px">{% trans "Answer" %}</a>

        {% if topic|can_delete:user %}
            <form action="{% url 'forum:delete_topic' topic.pk %}" method="post">
                {% csrf_token %}
                <button class="pull-right btn btn-small btn-danger delete-topic" style="margin: 0 5px 5px">{% trans "Delete" %}</button>
            </form>
        {% endif %}

        {% if is_paginated %}
            {% paginate float='left' %}
        {% endif %}

        {% for post in object_list %}
            {% include "djforum/_post.html" %}
        {% endfor %}

        {% if is_paginated %}
            {% paginate float='left' %}
        {% endif %}

        {% if form %}
        <form action="{% url 'forum:add_post' topic.pk %}" method="post" class="post-form form-horizontal">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-small submit-button">{% trans "Submit" %}</button>
            {{ form.body }}
        </form>
        {% endif %}
    </aside>
{% endblock %}